# **Архитектурная документация CLI-интерпретатора**  
*(Соответствует стандарту IEEE 42010:2011)*  

---

# **1. Введение**  

## **1.1. Назначение документа**  
Этот документ представляет архитектуру CLI-интерпретатора, разработанного для обработки команд в текстовом режиме.  
Документ содержит:  
- Общие сведения о системе.  
- Архитектурные решения и компоненты.  
- Диаграммы взаимодействия.  
- Развёртывание и обеспечение качества.

## **1.2. Область применения**  
CLI-интерпретатор выполняет команды, аналогично Unix Shell.  
Функции:  
- Встроенные команды (`cat`, `echo`, `wc`, `pwd`, `exit`).  
- Переменные окружения (`VAR=value`, `$VAR`).  
- Запуск внешних программ.  
- Пайплайны (`|`).  

## **1.3. Аудитория**  
Документ предназначен для:  
- **Разработчиков** (расширение и поддержка системы).  
- **Тестировщиков** (верификация работы).  
- **Архитекторов** (анализ структуры системы).  
- **DevOps-инженеров** (интеграция в CI/CD).  

## **1.4. Определения и сокращения**  
| Термин | Определение |
|--------|------------|
| **CLI** | Command-Line Interface (командная строка) |
| **REPL** | Read-Eval-Print Loop (цикл обработки команд) |
| **Executor** | Исполнитель команд |
| **Parser** | Разбор входных данных |
| **Pipes** | Обработчик пайплайнов |

---

# **2. Представление архитектуры**  

## **2.1. Заинтересованные стороны и их интересы**  

| Заинтересованная сторона | Интересы |
|--------------------------|----------|
| Пользователь | Удобный интерфейс командной строки |
| Разработчик | Простая поддержка и расширение системы |
| Тестировщик | Проверка работы команд, переменных и пайпов |
| DevOps-инженер | Возможность интеграции в автоматизированные процессы |
| Архитектор | Масштабируемость и модульность решения |

## **2.2. Архитектурные взгляды**  
- **Функциональный** (как система выполняет задачи).  
- **Информационный** (поток данных).  
- **Развёртывание** (среда выполнения).  

---

# **3. Архитектурные решения**  

## **3.1. Основные принципы**  
- **Модульность**: разделение системы на независимые компоненты.  
- **Расширяемость**: возможность добавления новых команд.  
- **Кроссплатформенность**: поддержка Windows и Linux.  
- **Изоляция окружения**: переменные среды управляются отдельным модулем.  

## **3.2. Выбор технологического стека**  
- **Язык**: **Go**.  
- **Запуск процессов**: `os/exec`.  
- **Потоки данных**: `stdin, stdout, stderr`.  

## **3.3. Основные компоненты**  

### **3.3.1. REPL (`internal/repl`)**  
- Основной цикл обработки команд.  
- Обращается к `Parser`, `Environment`, `Executor`.  
- Завершается по `exit`.  

### **3.3.2. Parser (`internal/parser`)**  
- Разбирает строку на токены.  
- Обрабатывает кавычки и экранирование.  
- Формирует структуру команды.  

### **3.3.3. Substitutor (`internal/substitutor`)**  
- Подставляет переменные окружения (`$VAR → значение`).  
- Работает **до токенизации**.  

### **3.3.4. Environment (`internal/env`)**  
- Хранит переменные окружения.  
- Поддерживает `WindowsEnvironment` и `LinuxEnvironment`.  

### **3.3.5. Executor (`internal/executor`)**  
- Выполняет команды.  
- Различает встроенные (`pwd`, `exit`) и внешние (`ls`, `git`).  
- Возвращает `Result (output, exit_code)`.  

### **3.3.6. Pipes (`internal/pipes`)**  
- Разбирает `|`.  
- Связывает процессы через `stdin/stdout`.  

---

# **4. Описание представлений**  

## **4.1. Функциональный взгляд**  

### **4.1.1. Поток выполнения команды**  
1. `REPL` получает строку.  
2. `Substitutor` выполняет подстановку переменных.  
3. `Parser` разбирает команду.  
4. `Executor` исполняет её.  
5. `Pipes` соединяет команды при наличии `|`.  
6. Вывод отправляется в `stdout` или следующей команде.  

## **4.2. Информационный взгляд**  

### **4.2.1. Обработка переменных окружения**  
- `Environment` хранит и модифицирует переменные.  
- `Substitutor` заменяет `$VAR`.  

### **4.2.2. Обработка пайплайнов**  
- `Pipes` создаёт дочерние процессы.  
- Связывает их `stdout → stdin`.  

## **4.3. Диаграмма классов**  

![Диаграмма](./Диаграмма%20классов.drawio.svg)

---

# **5. Развёртывание**  

## **5.1. Поддерживаемые платформы**  
- **Linux**  
- **Windows**  

## **5.2. Среда выполнения**  
- Запуск как консольное приложение.  
- Возможность интеграции в CI/CD.  

---

# **6. Качество системы**  

## **6.1. Масштабируемость**  
- Возможность добавления новых встроенных команд.  

## **6.2. Производительность**  
- Минимальное потребление памяти.  
- Оптимизированная работа с процессами.  

## **6.3. Безопасность**  
- Изоляция внешних процессов.  
- Запрет выполнения вредоносных команд.  

---

# **7. Заключение**  
CLI-интерпретатор представляет собой модульную, расширяемую и кроссплатформенную систему.  
Документ описывает ключевые архитектурные решения, обеспечивающие удобство использования и поддержки.  
