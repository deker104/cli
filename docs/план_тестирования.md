# Тест-план для CLI-интерпретатора

## 1. Общая информация

**Название проекта:** CLI-интерпретатор

**Дата начала тестирования:** 01.04.2025

**Дата завершения:** 12.05.2025

**Цель:** Проверка корректности, устойчивости и кроссплатформенной совместимости интерпретатора командной строки, реализованного на Go.  

---

## 2. Цели и задачи тестирования

### 2.1 Цели
- Убедиться, что интерпретатор корректно обрабатывает команды, включая встроенные и внешние.
- Проверить корректность выполнения команд в пайплайне.
- Проверить корректность подстановки переменных окружения.
- Убедиться в устойчивости интерпретатора к ошибкам (ошибка не должна прерывать сессию).
- Проверить поддержку одиночных и двойных кавычек (различие между "слабым" и "сильным" окружением).
- Проверить работу на различных ОС.

### 2.2 Задачи
- Разработать и выполнить модульные тесты для всех внутренних компонентов.
- Разработать интеграционные тесты, эмулирующие ввод пользователя.
- Убедиться, что поведение программы соответствует спецификации.
- Проверить кроссплатформенность (Linux, Windows, macOS).

---

## 3. Объекты тестирования

- **Модуль `env`** — управление переменными окружения.
- **Модуль `parser`** — парсинг пользовательского ввода, включая кавычки и пайпы.
- **Модуль `substitutor`** — обработка подстановки переменных.
- **Модуль `executor`** — выполнение команд, в том числе пайпов и встроенных команд.
- **CLI-оболочка** — взаимодействие с пользователем через `stdin/stdout`.

---

## 4. Объем тестирования

### 4.1 Покрываемые типы команд
- Встроенные: `echo`, `pwd`, `cat`, `wc`, `grep`, `exit`
- Внешние: любые команды, доступные в `PATH`
- Ошибочные команды: несуществующие команды, отсутствие аргументов и пр.

### 4.2 Покрываемые сценарии
- Простая команда
- Команда с переменными
- Команда с кавычками
- Команда с ошибкой
- Несколько последовательных команд
- Пайпинг (`|`)
- Ошибка внутри пайпа
- Подстановка переменных (`$HOME`, `$?`)
- Одинарные/двойные кавычки
- Разные платформы

---

## 5. Подходы и стратегии

- **Модульное тестирование:** используется `testing` из Go для проверки функций в `env`, `executor`, `parser`, `substitutor`.
- **Интеграционное тестирование:** запуск CLI через `go run` и эмуляция пользовательского ввода.
- **Smoke-тесты:** тесты, проверяющие запуск базовых команд (`echo`, `pwd`, `exit`).
- **Регрессионное тестирование:** проводится при изменении логики пайпов, подстановки, или парсера.
- **Кроссплатформенное тестирование:** CI-сборка в GitHub Actions для `ubuntu-latest`, `windows-latest`, `macos-latest`.

---

## 6. Инструменты

- Go (`go test`, `go run`)
- GitHub Actions (CI/CD)
- Bash и PowerShell для ручного запуска
- `diff`, `wc`, `grep`, `cat`, и т.д. — для тестов внешних команд

---

## 7. Планируемые ресурсы

| Ресурс         | Назначение                              |
|----------------|------------------------------------------|
| Разработчик    | Написание кода и тестов                  |
| Тестировщик    | Проведение ручного и автоматизированного тестирования |
| GitHub Actions | Автоматический запуск тестов             |
| ОС             | Ubuntu 22.04, Windows 10, macOS Monterey |

---


## 8. Метрики и критерии завершения

### 8.1 Метрики
- **Процент покрытия кода тестами**
- **Количество упавших тестов**

### 8.2 Критерии завершения
- Все тесты пройдены успешно.
- Покрытие кода тестами > 90%.
- Все платформы прошли сборку и тестирование.
- Ошибки, выявленные в CI, исправлены и перепроверены.

---

## 9. Оценка рисков

| Риск                              | Вероятность | Влияние | Меры устранения                    |
|-----------------------------------|-------------|---------|------------------------------------|
| Различия в поведении команд на ОС | Высокая     | Среднее | Изолировать через mock или фильтр  |
| Ошибки в пайпах                   | Средняя     | Высокое | Покрытие пайпов юнит- и интегра-тестами |
| Изменения в структуре токенов     | Средняя     | Среднее | Регулярные регрессионные тесты     |

---

## 10. Приложения

Ниже приведён список всех тестовых модулей и краткое описание покрываемых ими аспектов.

###  `integration_test.go`

**Тип:** Интеграционные (end-to-end) тесты  
**Назначение:**  
Проверка полного цикла работы CLI-интерпретатора при запуске из консоли:

- Эмуляция пользовательского ввода через `stdin`
- Проверка работы всех встроенных команд (`echo`, `cat`, `grep`, `pwd`, `exit`, `wc`)
- Проверка пайплайнов команд (включая комбинации из нескольких команд)
- Проверка одиночных (`'`) и двойных (`"`) кавычек
- Проверка подстановки переменных окружения и `$?`
- Проверка устойчивости к ошибкам: после ошибки команда должна продолжать работу
- Проверка кодов возврата (exit codes)
- Проверка работы в случае несуществующих файлов и внешних команд

###  `executor_test.go`

**Тип:** Модульные тесты  
**Назначение:**  
Покрытие логики модуля `executor`, включая:

- Встроенные команды (`echo`, `pwd`, `exit`)
- Поведение при неизвестных командах
- Поведение при ошибках внешних команд
- Пайпинг: передача stdout одной команды в stdin другой
- Обработка ошибок в пайпах (например, если одна из команд завершилась с ошибкой)

Проверки ведутся как через `os.Stdout`, так и через `os.Stderr`.

###  `parser_test.go`

**Тип:** Модульные тесты  
**Назначение:**  
Тесты на корректность разбора строки ввода:

- Разделение на токены
- Обработка пайпов (`|`)
- Поддержка кавычек:
  - Одинарные кавычки `'value'` — отключают подстановку переменных
  - Двойные кавычки `"value"` — сохраняют пробелы, допускают подстановки
- Вложенные команды и несколько пайпов

Также проверяется наличие флага `SubstituteEnv` для токенов, указывающего, нужно ли выполнять подстановку.

###  `env_test.go`

**Тип:** Модульные тесты  
**Назначение:**  
Проверка работы модуля `env` (обёртка над системными переменными окружения):

- Установка, получение и переопределение переменных
- Поведение при запросе неустановленной переменной
- Доступ к системным переменным (`PATH` и т.д.)
- Хранение и чтение нескольких переменных

###  `substitutor_test.go`

**Тип:** Модульные тесты  
**Назначение:**  
Проверка логики подстановки переменных окружения и кода возврата:

- Подстановка значения переменных (`$FOO`, `$HOME`)
- Подстановка специальной переменной `$?` (код возврата предыдущей команды)
- Проверка отключения подстановки при использовании сильных кавычек
- Поддержка смешанных токенов (часть с подстановкой, часть без)

Тестируется, что `Substitute()` корректно преобразует `[]Token` в `[]string`, подставляя нужные значения.


---
