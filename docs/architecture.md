# Архитектура CLI-интерпретатора

## 1. Описание проекта  
CLI-интерпретатор — это командная оболочка, аналогичная Unix Shell.  
Он поддерживает:  

- **Встроенные команды** (`cat`, `echo`, `wc`, `pwd`, `exit`)  
- **Переменные окружения** (`VAR=value`, `$VAR`)  
- **Запуск внешних программ**  
- **Пайплайны (`|`)** для передачи вывода одной команды в другую

## 2. Основные компоненты системы  

Система состоит из нескольких модулей:  

### **1. REPL (`internal/repl`)**  
- Цикл `read-eval-print` (читаем ввод, выполняем команду, выводим результат).  
- Обращается к `Parser`, `Environment`, `Executor`.  
- Завершается при вводе `exit`.  

### **2. Парсер команд (`internal/parser`)**  
- Разбирает введённую строку на токены.  
- Обрабатывает кавычки (`"`, `'`).  
- Выполняет экранирование (`\`).  
- Создаёт структуру команды с аргументами.  
- Передаёт команду в `Executor`.

### **3. Подстановщик переменных (`internal/substitutor`)**  
- Выполняет замену `$VAR` на соответствующее значение **до токенизации**.  
- Работает с `Environment`.  

### **4. Менеджер окружения (`internal/env`)**  
- Хранит переменные окружения (`VAR=value`).  
- Позволяет изменять и запрашивать переменные.  
- `WindowsEnvironment` и `LinuxEnvironment` реализуют интерфейс `Environment`.  

### **5. Исполнитель команд (`internal/executor`)**  
- Определяет, встроенная ли команда.  
- Для встроенных команд (`pwd`, `exit`) выполняет их сам.  
- Для внешних команд (`ls`, `git`) вызывает `os/exec`.  
- Возвращает `Result (output, exit_code)`.
- Добавлена новая встроенная команда `grep` с:
  - Поддержкой регулярных выражений через `regexp`
  - Обработкой флагов:
    - `-i` (игнорирование регистра)
    - `-w` (поиск целых слов)
    - `-A n` (вывод n строк после совпадения)
  - Работой как с файлами, так и с пайпами  

### **6. Обработчик пайпов (`internal/pipes`)**  
- Разбирает `|`, создавая цепочку команд.  
- Настраивает `stdin/stdout` для передачи данных между процессами.
- Добавлена специальная обработка для команды `grep`:
  - Корректная работа с флагом `-A` в пайплайнах
  - Эффективная буферизация вывода

## 3. Диаграмма классов

![Диаграмма](./Диаграмма%20классов.drawio.svg)